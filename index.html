<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body style="display: flex; flex-direction: column; align-items: center;">



<!------------------------------------- Les images ----------------------------------------->    
    <div style="display: none;">

    <svg id="vaisseau_svg" viewBox="0 0 13 10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <rect width="3" height="1" fill="black" x="5" y="9"/>
        <rect width="1" height="1" fill="black" x="0" y="8"/>
        <rect width="2" height="1" fill="black" x="4" y="8"/>
        <rect width="2" height="1" fill="black" x="7" y="8"/>
        <rect width="1" height="1" fill="black" x="12" y="8"/>
        <rect width="13" height="1" fill="black" x="0" y="7"/>
        <rect width="6" height="2" fill="black" x="0" y="5"/>
        <rect width="6" height="2" fill="black" x="7" y="5"/>
        <rect width="1" height="1" fill="black" x="0" y="4"/>
        <rect width="1" height="1" fill="black" x="2" y="4"/>
        <rect width="3" height="1" fill="black" x="5" y="4"/>
        <rect width="1" height="1" fill="black" x="10" y="4"/>
        <rect width="1" height="1" fill="black" x="12" y="4"/>
        <rect width="1" height="1" fill="black" x="0" y="3"/>
        <rect width="1" height="1" fill="black" x="2" y="3"/>
        <rect width="3" height="1" fill="black" x="5" y="3"/>
        <rect width="1" height="1" fill="black" x="10" y="3"/>
        <rect width="1" height="1" fill="black" x="12" y="3"/>
        <rect width="1" height="1" fill="black" x="0" y="2"/>
        <rect width="3" height="1" fill="black" x="5" y="2"/>
        <rect width="1" height="1" fill="black" x="12" y="2"/>
        <rect width="3" height="1" fill="black" x="5" y="1"/>
        <rect width="1" height="1" fill="black" x="6" y="0"/>
      </svg>
    <img id="vaisseau">
    <script>
    document.getElementById('vaisseau').src = 'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(document.getElementById('vaisseau_svg')));
    </script>


    <svg id="invader_svg" viewBox="0 0 11 8" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <rect width="1" height="1" fill="black" x="2" y="0"/>
        <rect width="1" height="1" fill="black" x="8" y="0"/>
        <rect width="1" height="1" fill="black" x="3" y="1"/>
        <rect width="1" height="1" fill="black" x="7" y="1"/>
        <rect width="7" height="1" fill="black" x="2" y="2"/>
        <rect width="2" height="1" fill="black" x="1" y="3"/>
        <rect width="3" height="1" fill="black" x="4" y="3"/>
        <rect width="2" height="1" fill="black" x="8" y="3"/>
        <rect width="11" height="1" fill="black" x="0" y="4"/>
        <rect width="1" height="1" fill="black" x="0" y="5"/>
        <rect width="7" height="1" fill="black" x="2" y="5"/>
        <rect width="1" height="1" fill="black" x="10" y="5"/>
        <rect width="1" height="1" fill="black" x="0" y="6"/>
        <rect width="1" height="1" fill="black" x="2" y="6"/>
        <rect width="1" height="1" fill="black" x="8" y="6"/>
        <rect width="1" height="1" fill="black" x="10" y="6"/>
        <rect width="2" height="1" fill="black" x="3" y="7"/>
        <rect width="2" height="1" fill="black" x="6" y="7"/>
      </svg>
    <img id="invader">
    <script>
    document.getElementById('invader').src = 'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(document.getElementById('invader_svg')));
    </script>


<svg id="go_svg" viewBox="0 0 31 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        <!-- G -->
        <rect width="2" height="3" fill="black" x="0" y="2"/>
        <rect width="2" height="4" fill="black" x="5" y="3"/>
        <rect width="1" height="1" fill="black" x="4" y="3"/>
        <rect width="5" height="1" fill="black" x="2" y="6"/>
        <rect width="2" height="1" fill="black" x="1" y="5"/>
        <rect width="2" height="1" fill="black" x="1" y="1"/>
        <rect width="5" height="1" fill="black" x="2" y="0"/>
        <!-- A -->
        <rect width="2" height="5" fill="black" x="8" y="2"/>
        <rect width="2" height="5" fill="black" x="13" y="2"/>
        <rect width="7" height="1" fill="black" x="8" y="4"/>
        <rect width="2" height="1" fill="black" x="9" y="1"/>
        <rect width="2" height="1" fill="black" x="12" y="1"/>
        <rect width="3" height="1" fill="black" x="10" y="0"/>
        <!-- M -->
        <rect width="2" height="7" fill="black" x="16" y="0"/>
        <rect width="2" height="7" fill="black" x="21" y="0"/>
        <rect width="1" height="3" fill="black" x="18" y="1"/>
        <rect width="1" height="3" fill="black" x="20" y="1"/>
        <rect width="1" height="3" fill="black" x="19" y="2"/>
        <!-- E -->
        <rect width="2" height="7" fill="black" x="24" y="0"/>
        <rect width="7" height="1" fill="black" x="24" y="0"/>
        <rect width="6" height="1" fill="black" x="24" y="3"/>
        <rect width="7" height="1" fill="black" x="24" y="6"/>
        <!-- O -->
        <rect width="2" height="5" fill="black" x="0" y="10"/>
        <rect width="2" height="5" fill="black" x="5" y="10"/>
        <rect width="5" height="1" fill="black" x="1" y="9"/>
        <rect width="5" height="1" fill="black" x="1" y="15"/>
        <!-- V -->
        <rect width="2" height="4" fill="black" x="8" y="9"/>
        <rect width="2" height="4" fill="black" x="13" y="9"/>
        <rect width="2" height="2" fill="black" x="9" y="12"/>
        <rect width="2" height="2" fill="black" x="12" y="12"/>
        <rect width="3" height="2" fill="black" x="10" y="13"/>
        <rect width="1" height="1" fill="black" x="11" y="15"/>
        <!-- E -->
        <rect width="2" height="7" fill="black" x="16" y="9"/>
        <rect width="7" height="1" fill="black" x="16" y="9"/>
        <rect width="6" height="1" fill="black" x="16" y="12"/>
        <rect width="7" height="1" fill="black" x="16" y="15"/>
        <!-- R -->
        <rect width="2" height="7" fill="black" x="24" y="9"/>
        <rect width="6" height="1" fill="black" x="24" y="9"/>
        <rect width="5" height="1" fill="black" x="24" y="13"/>
        <rect width="3" height="1" fill="black" x="28" y="12"/>
        <rect width="3" height="1" fill="black" x="28" y="15"/>
        <rect width="3" height="1" fill="black" x="27" y="14"/>
        <rect width="2" height="3" fill="black" x="29" y="10"/>
  </svg>
<img id="go">
<script>
document.getElementById('go').src = 'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(document.getElementById('go_svg')));
</script>


<svg id="win_svg" viewBox="0 0 22 13" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <!--Y-->
    <rect width="2" height="2" fill="black" x="1" y="0"/>
    <rect width="2" height="2" fill="black" x="4" y="0"/>
    <rect width="3" height="1" fill="black" x="2" y="2"/>
    <rect width="1" height="2" fill="black" x="3" y="3"/>
    <!--o-->
    <rect width="2" height="3" fill="black" x="7" y="1"/>
    <rect width="2" height="3" fill="black" x="12" y="1"/>
    <rect width="5" height="1" fill="black" x="8" y="0"/>
    <rect width="5" height="1" fill="black" x="8" y="4"/>
    <!--U-->
    <rect width="2" height="4" fill="black" x="15" y="0"/>
    <rect width="2" height="4" fill="black" x="18" y="0"/>
    <rect width="3" height="1" fill="black" x="16" y="4"/>
    <!--W-->
    <rect width="2" height="5" fill="black" x="0" y="8"/>
    <rect width="2" height="5" fill="black" x="7" y="8"/>
    <rect width="1" height="2" fill="black" x="2" y="10"/>
    <rect width="1" height="1" fill="black" x="3" y="10"/>
    <rect width="1" height="1" fill="black" x="4" y="9"/>
    <rect width="1" height="1" fill="black" x="5" y="10"/>
    <rect width="1" height="2" fill="black" x="6" y="10"/>
    <!--I-->
    <rect width="4" height="1" fill="black" x="10" y="8"/>
    <rect width="2" height="3" fill="black" x="11" y="9"/>
    <rect width="4" height="1" fill="black" x="10" y="12"/>
    <!--N-->
    <rect width="2" height="5" fill="black" x="15" y="8"/>
    <rect width="2" height="5" fill="black" x="20" y="8"/>
    <rect width="1" height="2" fill="black" x="17" y="9"/>
    <rect width="1" height="2" fill="black" x="18" y="10"/>
    <rect width="1" height="2" fill="black" x="19" y="11"/>
      </svg>
    <img id="win">
    <script>
    document.getElementById('win').src = 'data:image/svg+xml;base64,' + btoa(new XMLSerializer().serializeToString(document.getElementById('win_svg')));
    </script>


    </div>



<!------------------------------ Affichage du statut du jeu ------------------------------------>
    <div>Vie(s): </div><div id="vie">0</div>
    <div>Score: </div><div id="score">0</div>
    <div>Level: </div><div id="level">0 / 10</div>

    <form type="post"><button type="submit">Recommencer le jeu</button></form>

    <canvas id="space-invaders" width="400" height="300" style="border: 1px solid; margin: 0 auto 0 auto; width: 50vw; height: 50vh;"/>

<!----------------------------------------Le jeux------------------------------------------------>
    <script type="text/javascript" defer>
        var vaisseaux=190;
        var vaisseauy=250;
        var invader1x=50, invader1y=20, invader2x=140, invader2y=20, invader3x=240, invader3y=20, invader4x=330, invader4y=20;
        var vitesse1=1500;
        var vitesse2=2250;
        var vitesse3=2000;
        var vitesse4=1750;
        var invader1_vie=1;
        var invader2_vie=1;
        var invader3_vie=1;
        var invader4_vie=1;
        var calcul_score=1;
        var score=0;
        var vie=2;
        var level=0;
        var game_over_si_1=0;
        var dy = 10;

        var canvas = document.getElementById("space-invaders");
        var format2d = canvas.getContext("2d");
        var vaisseau = document.getElementById("vaisseau");
        var invader = document.getElementById("invader");
        var go = document.getElementById("go");


            //affiche une première fois
            window.onload = function() {
                format2d.drawImage(vaisseau, vaisseaux, vaisseauy, 20, 20);
                format2d.drawImage(invader, invader1x, invader1y, 20, 20);
                format2d.drawImage(invader, invader2x, invader2y, 20, 20);
                format2d.drawImage(invader, invader3x, invader3y, 20, 20);
                format2d.drawImage(invader, invader4x, invader4y, 20, 20);
            };

        // affichage sur la page web des résultats
        function affichage(){
            document.querySelector('#vie').innerHTML = vie;
            document.querySelector('#score').innerHTML = score;
            document.querySelector('#level').innerHTML = level + " / 10";
        }
        setInterval(affichage, 50);


        // augmente le level si tout les invaders sont détruite ou sortis par le bas
        setInterval("if(invader1_vie==0 && invader2_vie==0 && invader3_vie==0 && invader4_vie==0 && game_over_si_1==0){level_up();}", 2000);

        // 1 potentiel déplacement sans colision et tir ou pas avec test de colision
        function action(){
        setInterval("if(invader1_vie==1){invader1();}", vitesse1);
        setInterval("if(invader2_vie==1){invader2();}", vitesse2);
        setInterval("if(invader3_vie==1){invader3();}", vitesse3); 
        setInterval("if(invader4_vie==1){invader4();}", vitesse4);
        }
        action();


        function invader1(){
            var x;
            var y;
            format2d.clearRect(invader1x, invader1y, 20, 20); // efface l'invader
            var numberx = (Math.floor(Math.random() * 20)) - 10; // choix au hasard < ou >
            if(!((((invader1x+numberx)>(invader2x+30)||((invader1x+numberx)+30)<invader2x)||(invader1y>(invader2y+30)||(invader1y+30)<invader2y)) && (((invader1x+numberx)>(invader3x+30)||((invader1x+numberx)+30)<invader3x)||(invader1y>(invader3y+30)||(invader1y+30)<invader3y)) && (((invader1x+numberx)>(invader4x+30)||((invader1x+numberx)+30)<invader4x)||(invader1y>(invader4y+30)||(invader1y+30)<invader4y)))){ // test si l'invader s'approche trop d'un autre avant application du calcul en x
                format2d.drawImage(invader, invader1x, invader1y, 20, 20); // si le nouveau calcul en x prévoit une colision avec un autre invader on réaffiche l'invader sans le déplacé de son point d'origine
            }else if(((invader1x)<=(canvas.width-30)) && (invader1x>=10)){ // test si l'invader ne dépasse pas le décord en x
            invader1x += numberx; // on écarte l'invader du décord en x
            }else if(invader1x>(canvas.width/2)){ // on déplace l'invader en x < ou >
                invader1x -=10;
            }else {
                invader1x +=10;
            }
            var numbery = (Math.floor(Math.random() * 20)) - 5; // -5 au lieu de -10 pour le bouger vers le bas statistiquement
            if(!(((invader1x>(invader2x+30)||(invader1x+30)<invader2x)||((invader1y+numbery)>(invader2y+30)||((invader1y+numbery)+30)<invader2y)) && ((invader1x>(invader3x+30)||(invader1x+30)<invader3x)||((invader1y+numbery)>(invader3y+30)||((invader1y+numbery)+30)<invader3y)) && ((invader1x>(invader4x+30)||(invader1x+30)<invader4x)||((invader1y+numbery)>(invader4y+30)||((invader1y+numbery)+30)<invader4y)))){ // test si l'invader s'approche trop d'un autre avant application du calcul en y
                invader1x -= numberx; // car il faut remettre comme c'était avant, on recommencera ensuite un recalcul de la trajectoir
                format2d.drawImage(invader, invader1x, invader1y, 20, 20); // si le nouveau calcul en y prévoit une colision avec un autre invader on réaffiche l'invader sans le déplacé de son point d'origine
            }else if(invader1y<=(canvas.height)){ // test si l'invader ne dépasse pas le décord en y
            invader1y += numbery; // on déplace l'invader vers le bas
            }else if(invader1y>(canvas.height)){ // si est descendu du décord
                invader1_vie=0; // on supprime la vie de l'invader
            }
            format2d.drawImage(invader, invader1x, invader1y, 20, 20); // réaffiche ensuite avec la nouvelle position
            var invader_tire = Math.floor(Math.random() * 20); // choix au hasard si tire il y a
            if(invader_tire<=10){ // si tire
                    var level_next = level;
                    x = invader1x + 9; // position initial de tire en fonction de la postion de l'invader
                    y = invader1y + 30;
                    function balle_invader(){ // fonction balle de l'invader ajouté
                        format2d.fillRect(x, y, 2, 10); // affichage de la balle avec sa nouvelle position
                        format2d.clearRect(x, y-10, 2, 10);
                        if(x>=vaisseaux && x<=(vaisseaux+20) && y>=vaisseauy && y<=(vaisseauy+20)){ // si la balle a touché le vaisseau
                            format2d.clearRect(x, y, 2, 10); // on efface la balle
                            y = 10000;  // on met la balle plus loin
                            game_over(); // moins une vie pour le vaisseau et test si "game over"
                        }
                        if(level_next == level){ // test si le level n'a pas évolué
                            y += dy; // incrémentation de la balle vers le bas
                            }else{ // sinon les balles envoyées dans le level précédent sont effacées, déplacées vers l'extérieur au même endroit et arrêtées
                                format2d.clearRect(x, y, 2, 10);
                                x = 100000;
                                y = 100000;
                            }
                    }
                setInterval(balle_invader, 120); // vitesse de la balle de l'invader 1
            }
        }

        function invader2(){
            var x;
            var y;
            format2d.clearRect(invader2x, invader2y, 20, 20); // efface l'invader
            var numberx = (Math.floor(Math.random() * 20)) - 10; // choix au hasard < ou >
            if(!((((invader2x+numberx)>(invader1x+30)||((invader2x+numberx)+30)<invader1x)||(invader2y>(invader1y+30)||(invader2y+30)<invader1y)) && (((invader2x+numberx)>(invader3x+30)||((invader2x+numberx)+30)<invader3x)||(invader2y>(invader3y+30)||(invader2y+30)<invader3y)) && (((invader2x+numberx)>(invader4x+30)||((invader2x+numberx)+30)<invader4x)||(invader2y>(invader4y+30)||(invader2y+30)<invader4y)))){ // test si l'invader s'approche trop d'un autre avant application du calcul en x
                format2d.drawImage(invader, invader2x, invader2y, 20, 20); // si le nouveau calcul en x prévoit une colision avec un autre invader on réaffiche l'invader sans le déplacé de son point d'origine
            }else if(((invader2x)<=(canvas.width-30)) && (invader2x>=10)){ // test si l'invader ne dépasse pas le décord en x
            invader2x += numberx; // on écarte l'invader du décord en x
            }else if(invader2x>(canvas.width/2)){ // on déplace l'invader en x < ou >
                invader2x -=10;
            }else {
                invader2x +=10;
            }
            var numbery = (Math.floor(Math.random() * 20)) - 5; // -5 au lieu de -10 pour le bouger vers le bas statistiquement
            if(!(((invader2x>(invader1x+30)||(invader2x+30)<invader1x)||((invader2y+numbery)>(invader1y+30)||((invader2y+numbery)+30)<invader1y)) && ((invader2x>(invader3x+30)||(invader2x+30)<invader3x)||((invader2y+numbery)>(invader3y+30)||((invader2y+numbery)+30)<invader3y)) && ((invader2x>(invader4x+30)||(invader2x+30)<invader4x)||((invader2y+numbery)>(invader4y+30)||((invader2y+numbery)+30)<invader4y)))){ // test si l'invader s'approche trop d'un autre avant application du calcul en y
                invader2x -= numberx; // car il faut remettre comme c'était avant, on recommencera ensuite un recalcul de la trajectoir
                format2d.drawImage(invader, invader2x, invader2y, 20, 20); // si le nouveau calcul en y prévoit une colision avec un autre invader on réaffiche l'invader sans le déplacé de son point d'origine
            }else if(invader2y<=(canvas.height)){ // test si l'invader ne dépasse pas le décord en y
                invader2y += numbery; // on déplace l'invader vers le bas
            }else if(invader2y>(canvas.height)){ // si est descendu du décord
                invader2_vie=0; // on supprime la vie de l'invader
                }
            format2d.drawImage(invader, invader2x, invader2y, 20, 20); // réaffiche ensuite avec la nouvelle position
            var invader_tire = Math.floor(Math.random() * 20); // choix au hasard si tire il y a
            if(invader_tire<=10){ // si tire
                    var level_next = level;
                    x = invader2x + 9; // position initial de tire en fonction de la postion de l'invader
                    y = invader2y + 30;
                    function balle_invader(){ // fonction balle de l'invader ajoutée
                        format2d.fillRect(x, y, 2, 10); // affichage de la balle avec sa nouvelle position
                        format2d.clearRect(x, y-10, 2, 10);
                        if(x>=vaisseaux && x<=(vaisseaux+20) && y>=vaisseauy && y<=(vaisseauy+20)){ // si la balle a touché le vaisseau
                            format2d.clearRect(x, y, 2, 10); // on efface la balle
                            y = 10000;  // on met la balle plus loin
                            game_over(); // moins une vie pour le vaisseau et test si "game over"
                        }
                        if(level_next == level){ // test si le level n'a pas évolué
                            y += dy; // incrémentation de la balle vers le bas
                            }else{ // sinon les balles envoyées dans le level précédent sont effacées, déplacées vers l'extérieur au même endroit et arrêtées
                                format2d.clearRect(x, y, 2, 10);
                                x = 100000;
                                y = 100000;
                            }
                    }
                setInterval(balle_invader, 120); // vitesse de la balle de l'invader 2
            }
        }

        function invader3(){
            var x;
            var y;
            format2d.clearRect(invader3x, invader3y, 20, 20); // efface l'invader
            var numberx = (Math.floor(Math.random() * 20)) - 10; // choix au hasard < ou >
            if(!((((invader3x+numberx)>(invader2x+30)||((invader3x+numberx)+30)<invader2x)||(invader3y>(invader2y+30)||(invader3y+30)<invader2y)) && (((invader3x+numberx)>(invader1x+30)||((invader3x+numberx)+30)<invader1x)||(invader3y>(invader1y+30)||(invader3y+30)<invader1y)) && (((invader3x+numberx)>(invader4x+30)||((invader3x+numberx)+30)<invader4x)||(invader3y>(invader4y+30)||(invader3y+30)<invader4y)))){ // test si l'invader s'approche trop d'un autre avant application du calcul en x
                format2d.drawImage(invader, invader3x, invader3y, 20, 20); // si le nouveau calcul en x prévoit une colision avec un autre invader on réaffiche l'invader sans le déplacé de son point d'origine
            }else if(((invader3x)<=(canvas.width-30)) && (invader3x>=10)){ // test si l'invader ne dépasse pas le décord en x
            invader3x += numberx; // on écarte l'invader du décord en x
            }else if(invader3x>(canvas.width/2)){ // on déplace l'invader en x < ou >
                invader3x -=10;
            }else {
                invader3x +=10;
            }
            var numbery = (Math.floor(Math.random() * 20)) - 5; // -5 au lieu de -10 pour le bouger vers le bas statistiquement
            if(!(((invader3x>(invader2x+30)||(invader3x+30)<invader2x)||((invader3y+numbery)>(invader2y+30)||((invader3y+numbery)+30)<invader2y)) && ((invader3x>(invader1x+30)||(invader3x+30)<invader1x)||((invader3y+numbery)>(invader1y+30)||((invader3y+numbery)+30)<invader1y)) && ((invader3x>(invader4x+30)||(invader3x+30)<invader4x)||((invader3y+numbery)>(invader4y+30)||((invader3y+numbery)+30)<invader4y)))){ // test si l'invader s'approche trop d'un autre avant application du calcul en y
                invader3x -= numberx; // car il faut remettre comme c'était avant, on recommencera ensuite un recalcul de la trajectoir
                format2d.drawImage(invader, invader3x, invader3y, 20, 20); // si le nouveau calcul en y prévoit une colision avec un autre invader on réaffiche l'invader sans le déplacé de son point d'origine
            }else if(invader3y<=(canvas.height)){ // test si l'invader ne dépasse pas le décord en y
                invader3y += numbery; // on déplace l'invader vers le bas
            }else if(invader3y>(canvas.height)){ // si est descendu du décord
                invader3_vie=0; // on supprime la vie de l'invader
                }
            format2d.drawImage(invader, invader3x, invader3y, 20, 20); // réaffiche ensuite avec la nouvelle position
            var invader_tire = Math.floor(Math.random() * 20); // choix au hasard si tire il y a
            if(invader_tire<=10){ // si tire
                    var level_next = level;
                    x = invader3x + 9; // position initial de tire en fonction de la postion de l'invader
                    y = invader3y + 30;
                    function balle_invader(){ // fonction balle de l'invader ajoutée
                        format2d.fillRect(x, y, 2, 10); // affichage de la balle avec sa nouvelle position
                        format2d.clearRect(x, y-10, 2, 10);
                        if(x>=vaisseaux && x<=(vaisseaux+20) && y>=vaisseauy && y<=(vaisseauy+20)){ // si la balle a touché le vaisseau
                            format2d.clearRect(x, y, 2, 10); // on efface la balle
                            y = 10000;  // on met la balle plus loin
                            game_over(); // moins une vie pour le vaisseau et test si "game over"
                        }
                        if(level_next == level){ // test si le level n'a pas évolué
                            y += dy; // incrémentation de la balle vers le bas
                            }else{ // sinon les balles envoyées dans le level précédent sont effacées, déplacées vers l'extérieur au même endroit et arrêtées
                                format2d.clearRect(x, y, 2, 10);
                                x = 100000;
                                y = 100000;
                            }
                    }
                setInterval(balle_invader, 120); // vitesse de la balle de l'invader 3
            }
        }

        function invader4(){
            var x;
            var y;
            format2d.clearRect(invader4x, invader4y, 20, 20); // efface l'invader
            var numberx = (Math.floor(Math.random() * 20)) - 10; // choix au hasard < ou >
            if(!((((invader4x+numberx)>(invader2x+30)||((invader4x+numberx)+30)<invader2x)||(invader4y>(invader2y+30)||(invader4y+30)<invader2y)) && (((invader4x+numberx)>(invader3x+30)||((invader4x+numberx)+30)<invader3x)||(invader4y>(invader3y+30)||(invader4y+30)<invader3y)) && (((invader4x+numberx)>(invader1x+30)||((invader4x+numberx)+30)<invader1x)||(invader4y>(invader1y+30)||(invader4y+30)<invader1y)))){ // test si l'invader s'approche trop d'un autre avant application du calcul en x
                format2d.drawImage(invader, invader4x, invader4y, 20, 20); // si le nouveau calcul en x prévoit une colision avec un autre invader on réaffiche l'invader sans le déplacé de son point d'origine
            }else if(((invader4x)<=(canvas.width-30)) && (invader4x>=10)){ // test si l'invader ne dépasse pas le décord en x
            invader4x += numberx; // on écarte l'invader du décord en x
            }else if(invader4x>(canvas.width/2)){ // on déplace l'invader en x < ou >
                invader4x -=10;
            }else {
                invader4x +=10;
            }
            var numbery = (Math.floor(Math.random() * 20)) - 5; // -5 au lieu de -10 pour le bouger vers le bas statistiquement
            if(!(((invader4x>(invader2x+30)||(invader4x+30)<invader2x)||((invader4y+numbery)>(invader2y+30)||((invader4y+numbery)+30)<invader2y)) && ((invader4x>(invader3x+30)||(invader4x+30)<invader3x)||((invader4y+numbery)>(invader3y+30)||((invader4y+numbery)+30)<invader3y)) && ((invader4x>(invader1x+30)||(invader4x+30)<invader1x)||((invader4y+numbery)>(invader1y+30)||((invader4y+numbery)+30)<invader1y)))){ // test si l'invader s'approche trop d'un autre avant application du calcul en y
                invader4x -= numberx; // car il faut remettre comme c'était avant, on recommencera ensuite un recalcul de la trajectoir
                format2d.drawImage(invader, invader4x, invader4y, 20, 20); // si le nouveau en y calcul prévoit une colision avec un autre invader on réaffiche l'invader sans le déplacé de son point d'origine
            }else if(invader4y<=(canvas.height)){ // test si l'invader ne dépasse pas le décord en y
                invader4y += numbery; // on déplace l'invader vers le bas
            }else if(invader4y>(canvas.height)){ // si est descendu du décord
                invader4_vie=0; // on supprime la vie de l'invader
                }
            format2d.drawImage(invader, invader4x, invader4y, 20, 20);// réaffiche ensuite avec la nouvelle position
            var invader_tire = Math.floor(Math.random() * 20); // choix au hasard si tire il y a
            if(invader_tire<=10){ // si tire
                    var level_next = level;
                    x = invader4x + 9; // position initial de tire en fonction de la postion de l'invader
                    y = invader4y + 30;
                    function balle_invader(){ // fonction balle de l'invader ajoutés
                        format2d.fillRect(x, y, 2, 10); // affichage de la balle avec sa nouvelle position
                        format2d.clearRect(x, y-10, 2, 10);
                        if(x>=vaisseaux && x<=(vaisseaux+20) && y>=vaisseauy && y<=(vaisseauy+20)){ // si la balle a touché le vaisseau
                            format2d.clearRect(x, y, 2, 10); // on efface la balle
                            y = 10000;  // on met la balle plus loin
                            game_over(); // moins une vie pour le vaisseau et test si "game over"
                        }
                        if(level_next == level){ // test si le level n'a pas évolué
                            y += dy; // incrémentation de la balle vers le bas
                            }else{ // sinon les balles envoyées dans le level précédent sont effacées, déplacées vers l'extérieur au même endroit et arrêtées
                                format2d.clearRect(x, y, 2, 10);
                                x = 100000;
                                y = 100000;
                            }

                    }
                setInterval(balle_invader, 120); // vitesse de la balle de l'invader 4
            }
        }

        function tire(){ // tire du vaisseau
        var level_next = level;
        var x = vaisseaux + 9; // position initial de tire en fonction de la postion du vaisseau
        var y = vaisseauy - 20;
        function balle_vaisseau(){ // fonction balle du vaisseau lancé
            format2d.fillRect(x, y, 2, 10); // affichage de la balle avec sa nouvelle position
            format2d.clearRect(x, y+10, 2, 10);
            if(x>=invader1x && x<=(invader1x+20) && y<=(invader1y+20)){ // si invander 1 touché:
                format2d.clearRect(invader1x, invader1y, 20, 20); // on efface
                invader1x = 10000; // on le déplace
                invader1y = 10000;
                format2d.clearRect(x, y, 2, 10); // efface la balle qui l'a touché
                y -= 1000; // on déplace la balle fantôme
                invader1_vie=0;
                score += calcul_score; // ajout des points
                return;  // arrêt de la fonction de cette balle
            }
            if(x>=invader2x && x<=(invader2x+20) && y<=(invader2y+20)){ // si invander 2 touché:
                format2d.clearRect(invader2x, invader2y, 20, 20); // on efface
                invader2x = 20000; // on le déplace
                invader2y = 20000;
                format2d.clearRect(x, y, 2, 10); // efface la balle qui l'a touché
                y -= 1000; // on déplace la balle fantôme
                invader2_vie=0;
                score += calcul_score; // ajout des points
                return;  // arrêt de la fonction de cette balle
            }
            if(x>=invader3x && x<=(invader3x+20) && y<=(invader3y+20)){ // si invander 3 touché:
                format2d.clearRect(invader3x, invader3y, 20, 20); // on efface
                invader3x = 30000; // on le déplace
                invader3y = 30000;
                format2d.clearRect(x, y, 2, 10); // efface la balle qui l'a touché
                y -= 1000; // on déplace la balle fantôme
                invader3_vie=0;
                score += calcul_score; // ajout des points
                return;  // arrêt de la fonction de cette balle
            }
            if(x>=invader4x && x<=(invader4x+20) && y<=(invader4y+20)){ // si invander 4 touché:
                format2d.clearRect(invader4x, invader4y, 20, 20); // on efface
                invader4x = 40000; // on le déplace
                invader4y = 40000;
                format2d.clearRect(x, y, 2, 10); // efface la balle qui l'a touché
                y -= 1000; // on déplace la balle fantôme
                invader4_vie=0;
                score += calcul_score; // ajout des points
                return; // arrêt de la fonction de cette balle
            }
            if(y<0){ // si la balle touche le décord
                x = -100000;
                y = -100000;
                return; // on arrête la function de cette balle
            }else if(level_next == level){ // test si le level n'a pas évolué
            y -= dy; // incrémentation de la balle vers le haut
            }else{ // sinon balle envoyées dans le level précédent
                format2d.clearRect(x, y, 2, 10); // effacement balle
                x = -100000; // déplacement hors du décord
                y = -100000;
                return; // arrêt de la fonction de cette balle
            }
        }

        setInterval(balle_vaisseau, 100); // vitesse de la balle vu vaisseau
        }

        // détection de touche et execute les fonctions
        document.addEventListener("keydown", function(event) {
            if (event.key == "ArrowLeft"){
                deplacementgauche();
            } else if (event.key == "ArrowUp"){
                deplacementhaut();
            } else if (event.key == "ArrowRight"){
                deplacementdroite();
            } else if (event.key == "ArrowDown"){
                deplacementbas();
            } else if (event.key == " "){
                tire(); // fonction tire d'une nouvelle balle
            }
        });


        function deplacementgauche(){
            format2d.clearRect(vaisseaux, vaisseauy, 20, 20); // effacement vaisseau
            if(vaisseaux != 0){ // test si le vaisseau ne dépasse pas le décord en x
                vaisseaux -= 10; // déplacement gauche
            }
            format2d.drawImage(vaisseau, vaisseaux, vaisseauy, 20, 20); // réaffichage du vaisseau
        }

        function deplacementdroite(){
            format2d.clearRect(vaisseaux, vaisseauy, 20, 20); // effacement vaisseau
            if(vaisseaux != (canvas.width-20)){ // test si le vaisseau ne dépasse pas le décord en x
                vaisseaux += 10; // déplacement droite
            }
            format2d.drawImage(vaisseau, vaisseaux, vaisseauy, 20, 20); // réaffichage du vaisseau
        }

        function deplacementhaut(){
            format2d.clearRect(vaisseaux, vaisseauy, 20, 20); // effacement vaisseau
            if(vaisseauy != 0){ // test si le vaisseau ne dépasse pas le décord en y
                vaisseauy -= 10; // déplacement haut
            }
            format2d.drawImage(vaisseau, vaisseaux, vaisseauy, 20, 20); // réaffichage du vaisseau
        }

        function deplacementbas(){
            format2d.clearRect(vaisseaux, vaisseauy, 20, 20); // effacement vaisseau
            if(vaisseauy != (canvas.height-20)){ // test si le vaisseau ne dépasse pas le décord en y
                vaisseauy += 10; // déplacement bas
            }
            format2d.drawImage(vaisseau, vaisseaux, vaisseauy, 20, 20); // réaffichage du vaisseau
        }

        // test si level supplémentaire
        function level_up(){
            level += 1;
            calcul_score *= 2;
            if(vitesse3>1100){ // si on doit augmenter la vitesse des 4 invaders
                vitesse1 -= 100; // augmentatation générale
                vitesse2 -= 100;
                vitesse3 -= 100;
                vitesse4 -= 100;
                invader1_revie(); // revie des 4 invaders
                invader2_revie();
                invader3_revie();
                invader4_revie();
            }else{ // sinon c'est gagné
                game_over_si_1 = 1; // arrêt du jeux
                invader1_vie = 0; // arrêt de l'invader 1
                invader2_vie = 0; // arrêt de l'invader 2
                invader3_vie = 0; // arrêt de l'invader 3
                invader4_vie = 0; // arrêt de l'invader 4
                format2d.clearRect(0, 0, canvas.width, canvas.height); // effacement entier du canvas
                format2d.drawImage(win, 0, 0, canvas.width, canvas.height); // afficher "you win"
            }
            action();
        }

        function invader1_revie(){ // invader 1 relancé
            invader1x=50;
            invader1y=20;
            format2d.drawImage(invader, invader1x, invader1y, 20, 20); // position initiale de l'invader
            invader1_vie = 1;
        }
        function invader2_revie(){ // invader 2 relancé
            invader2x=140;
            invader2y=20;
            format2d.drawImage(invader, invader2x, invader2y, 20, 20); // position initiale de l'invader
            invader2_vie = 1;
        }
        function invader3_revie(){ // invader 3 relancé
            invader3x=240; 
            invader3y=20;
            format2d.drawImage(invader, invader3x, invader3y, 20, 20); // position initiale de l'invader
            invader3_vie = 1;
        }
        function invader4_revie(){ // invader 4 relancé
            invader4x=330;
            invader4y=20;
            format2d.drawImage(invader, invader4x, invader4y, 20, 20); // position initiale de l'invader
            invader4_vie = 1;
        }


        function game_over(){ // fonction si le vaisseau a été touché par une balle d'un invader
            format2d.clearRect(vaisseaux, vaisseauy, 20, 20);
            vaisseaux = 10000; // isolement du vaisseau à l'extérieur
            vaisseauy = 10000;
            vie -= 1; // moins une vie puisqu'il a été touché
            if(vie==0){ // si plus de vie
            game_over_si_1 = 1; // arrêt du jeux
            invader1_vie = 0; // arrêt de l'invader 1
            invader2_vie = 0; // arrêt de l'invader 2
            invader3_vie = 0; // arrêt de l'invader 3
            invader4_vie = 0; // arrêt de l'invader 4
            format2d.clearRect(0, 0, canvas.width, canvas.height); // effacement entier du canvas
            format2d.drawImage(go, 0, 0, canvas.width, canvas.height); // afficher "game over"
            }else{ // si il reste au moins une vie
            vaisseaux=190;
            vaisseauy=250;
            format2d.drawImage(vaisseau, vaisseaux, vaisseauy, 20, 20); // position initiale du vaisseau
            }
        }
    </script>


</body>
</html>